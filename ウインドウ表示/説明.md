# window.h - ウインドウクラスのヘッダーファイル

```
#pragma once
```
多重インクルード(インクルードの重複、多重定義など)を防ぐ。

```
#include <Windows.h>
```
Windows API の型・関数を使うためのヘッダーファイル。  

```
const int WHITE = 0xFFFFFF;

const long WINDOW_WIDTH = 500;
const long WINDOW_HEIGHT = 300;
```

定数定義。値は好きなように。\
・`WHITE` 白。ウインドウの背景色に使用。\
・`WINDOW_WIDTH`,`WINDOW_HEIGHT` ウインドウサイズ。幅と高さ。

```
class Window {
public:
	Window();
	~Window();

	HWND get() const;

private:
	WNDCLASSEX window;
	RECT rect;
	HWND handle;

	static LRESULT CALLBACK WindowProcedure(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam);
	void SetWindow();
};
```
ウインドウの作成/表示/管理をするクラス。詳しいメンバー関数の定義は windows.cpp にて。\
・`Window()` コンストラクタ。\
・`~Window()` デストラクタ。\
・`HWND get() const` メンバー変数のウインドウハンドルを取得する関数。ウインドウハンドルについては下記参照。\
・`WNDCLASSEX window` ウインドウクラスの情報構造体。`WNDCLASSEX` 型についてはメンバー関数の `SetWindow` を参照。\
・`RECT rect` ウインドウサイズの矩形。`left`.`right`,`top`,`bottom` からなる。ウインドウの四辺。\
・`HWND handle` ウインドウハンドル。ウインドウに割り当てられる識別子のようなもの。\
・`static LRESULT CALLBACK WindowProcedure(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam)`ウインドウプロシージャ。ウインドウプロシージャとは、OSから送られてきたメッセージを処理する関数。\
・`void SetWindow()` ウインドウの登録、生成を行う関数。コンストラクタで呼ばれる。

# window.cpp - ウインドウクラスの定義ファイル

```
#include "window.h"
#include <tchar.h>
```
インクルードファイル。`tchar.h` はASCII(`char`型)とUnicode(`wchar_t`型)を自動で切り替えてくれる。
```
Window::Window() {
	SetWindow();
}
```
コンストラクタ。`SetWindow` を呼ぶことでウインドウの生成、登録を行う。
```
Window::~Window() {
	UnregisterClass(window.lpszClassName, window.hInstance);
}
```
デストラクタ。`UnregisterClass` という`RegisterClassEx`(詳しくは`SetWindow`にて)で登録したウインドウクラスを解除する関数が呼ばれる。
```
HWND Window::get() const {
	return handle;
}
```
シンプルにメンバー変数の`handle` を返す。
```
LRESULT CALLBACK Window::WindowProcedure(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam) {
	if (msg == WM_DESTROY) {
		PostQuitMessage(0);
		return 0;
	}

	return DefWindowProc(hwnd, msg, wparam, lparam);
}
```
ウインドウプロシージャ。`CALLBACK` とはAPIが要求する呼び出し規約を指定するマクロ。\
・返り値は`LRESULT`。メッセージに対する処理を行ったか。\
・引数は4つ。
- `HWND hwnd` メッセージが送信されたウインドウのウインドウハンドル。
- `UINT msg` 送信されたメッセージ。
- `WPARAM wparam` メッセージの追加情報1。
- `LPARAM lparam` メッセージの追加情報2。

・受け取ったメッセージが`WM_DESTROY` なら`PostQuitMessage(0)` でシステムにアプリケーション終了を通知。それ以外のメッセージは`DefWindowProc` でOSがデフォルトの処理をしてくれる。
```
void Window::SetWindow() {
	window.cbSize = sizeof(WNDCLASSEX);
	window.cbClsExtra = 0;
	window.cbWndExtra = 0;
	window.hbrBackground = CreateSolidBrush(WHITE);
	window.hCursor = LoadCursor(NULL, IDC_ARROW);
	window.hIcon = LoadIcon(NULL, IDI_APPLICATION);
	window.hIconSm = LoadIcon(NULL, IDI_APPLICATION);
	window.hInstance = GetModuleHandle(0);
	window.lpfnWndProc = (WNDPROC)WindowProcedure;
	window.lpszClassName = _T("DirectX12");
	window.lpszMenuName = NULL;
	window.style = CS_HREDRAW | CS_VREDRAW;

	RegisterClassEx(&window);

	rect.left = 0;
	rect.right = WINDOW_WIDTH;
	rect.top = 0;
	rect.bottom = WINDOW_HEIGHT;

	AdjustWindowRect(&rect, WS_OVERLAPPEDWINDOW, false);

	handle = CreateWindow(
		window.lpszClassName,
		_T("DX12 SAMPLE"),
		WS_OVERLAPPEDWINDOW,
		CW_USEDEFAULT,
		CW_USEDEFAULT,
		rect.right - rect.left,
		rect.bottom - rect.top,
		nullptr,
		nullptr,
		window.hInstance,
		nullptr
	);
}
```
ウインドウの生成、登録。
```
window.cbSize = sizeof(WNDCLASSEX);
window.cbClsExtra = 0;
window.cbWndExtra = 0;
window.hbrBackground = CreateSolidBrush(WHITE);
window.hCursor = LoadCursor(NULL, IDC_ARROW);
window.hIcon = LoadIcon(NULL, IDI_APPLICATION);
window.hIconSm = LoadIcon(NULL, IDI_APPLICATION);
window.hInstance = GetModuleHandle(0);
window.lpfnWndProc = (WNDPROC)WindowProcedure;
window.lpszClassName = _T("DirectX12");
window.lpszMenuName = NULL;
window.style = CS_HREDRAW | CS_VREDRAW;
```
メンバー変数`WNDCLASSEX window` を`WNDCLASSEX` 型に合わせて初期化する。`WNDCLASSEX` のメンバー変数は以下。
- `cbSize` 構造体のサイズ。
- `cbClsExtra`,`cbWndExtra` 予備メモリ。基本的に0。
- `hbrBackground` ウインドウの領域の背景色。
- `hCursor` デフォルトカーソル。基本的には`NULL`。
- `hIcon`,`hIconSm` デフォルトアイコン。基本的には`NULL`。
- `hInstance` インスタンスハンドル。`GetModuleHandle(0)` で取得。
- `lpfnWndProc` ウインドウプロシージャ。上記のものの関数ポインタを渡す。
- `lpszClassName` ウインドウクラスの識別文字列。
- `lpszMenuName` メニュー名。メニューが無ければ`NULL`。
- `style` ウインドウクラスのスタイル。` CS_HREDRAW | CS_VREDRAW` は縦横サイズが変更されたときに再描画を行う。

```
RegisterClassEx(&window);
```
上記で初期化したウインドウをOS側に登録。
```
rect.left = 0;
rect.right = WINDOW_WIDTH;
rect.top = 0;
rect.bottom = WINDOW_HEIGHT;

AdjustWindowRect(&rect, WS_OVERLAPPEDWINDOW, false);
```
`RECT rect` を初期化する。`AdjustWindowRect` はタイトルバーなどを含めた全体のサイズに補正してくれる。
```
handle = CreateWindow(
	window.lpszClassName,
	_T("DX12 SAMPLE"),
	WS_OVERLAPPEDWINDOW,
	CW_USEDEFAULT,
	CW_USEDEFAULT,
	rect.right - rect.left,
	rect.bottom - rect.top,
	nullptr,
	nullptr,
	window.hInstance,
	nullptr
);
```
`CreateWindow` で実際のウインドウが生成される。引数は以下
1. ウインドウクラス名。
2. ウインドウ名。
3. ウインドウスタイル。`WS_OVERLAPPEDWINDOW` は枠付きウインドウ。
4. ウインドウの初期位置(X軸)。デフォルトは`CW_USEDEFAULT`。
5. ウインドウの初期位置(Y軸)。デフォルトは`CW_USEDEFAULT`。
6. ウインドウの横幅。
7. ウインドウの縦幅。
8. 親ウインドウのハンドル。なければ`NULL`。
9. メニューハンドル。なければ`NULL`。
10. インスタンスハンドル。
11. 追加パラメーター。特になければ`NULL`。
